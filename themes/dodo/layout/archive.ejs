<%
let posts = []
let dataTree = []
// 如果有分类 过滤其他类型
if (page.category) {
    posts = site.posts.filter(post => {
        let has = 0;
        post.categories.forEach(category => {
            if (page.category === category.name) {
                has = 1
            }
        })
        return has
    })
} else if (page.tag) {
    posts = site.posts.filter(post => {
        let has = 0;
        post.tags.forEach(tag => {
            if (page.tag === tag.name) {
                has = 1
            }
        })
        return has
    })
} else {
    posts = site.posts
}

posts.each(function (post) {
    let y = post.date.year();
    let hasYear = 0
    dataTree.forEach((item) => {
        if (item.year === y) {
            hasYear = 1
            item.posts.push(post)
        }
    })
    if (!hasYear) {
        dataTree.push({
            year: y,
            posts: [post]
        })
    }
})
dataTree.sort((a, b) => b.year - a.year)
%>

<% dataTree.forEach(item => { %>
    <div><%= item.year %></div>
    <% item.posts.forEach(post => { %>
        <p><a href="<%- url_for(post.path) %>"><%= post.date %><%= post.title %></a></p>
    <% }) %>
<% }) %>
